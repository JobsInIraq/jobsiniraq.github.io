/**
 * Unified Language Handler for JobsInIraq - Minified
 * @version 2.0.0 - Production Ready
 */
(function(){'use strict';const CONFIG={supportedLangs:['en','ar','ku'],rtlLangs:['ar','ku'],storageKey:'siteLanguage',defaultLang:'en',debug:false};function log(type,...args){if(!CONFIG.debug)return;const prefix='[i18n]';switch(type){case'info':console.log(prefix,...args);break;case'warn':console.warn(prefix,...args);break;case'error':console.error(prefix,...args);break;default:console.log(prefix,...args)}}function isRTL(lang){return CONFIG.rtlLangs.includes(lang)}function isValidLang(lang){return CONFIG.supportedLangs.includes(lang)}class UnifiedLanguageManager{constructor(){this.currentLang=this.getSavedLanguage();this.initialized=false;this.init()}getSavedLanguage(){try{const saved=localStorage.getItem(CONFIG.storageKey);if(isValidLang(saved)){return saved}}catch(e){log('warn','localStorage unavailable:',e.message)}return CONFIG.defaultLang}init(){log('info','Initializing language manager...');log('info','Current language:',this.currentLang);log('info','RTL mode:',isRTL(this.currentLang));this.applyLanguage(this.currentLang);if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',()=>{this.onDOMReady()})}else{this.onDOMReady()}this.initialized=true;log('info','Language manager initialized')}onDOMReady(){this.initializePicker();this.setupEventListeners();this.updateNavigationText(this.currentLang)}applyLanguage(lang){if(!isValidLang(lang)){log('warn','Invalid language:',lang,'- falling back to',CONFIG.defaultLang);lang=CONFIG.defaultLang}const rtl=isRTL(lang);document.documentElement.setAttribute('lang',lang);document.documentElement.setAttribute('dir',rtl?'rtl':'ltr');document.documentElement.setAttribute('data-locale',lang);if(document.body){document.body.setAttribute('data-locale',lang);document.body.setAttribute('data-rtl',rtl?'true':'false');document.body.classList.toggle('rtl',rtl);document.body.classList.toggle('ltr',!rtl)}this.updateNavigationText(lang);try{localStorage.setItem(CONFIG.storageKey,lang)}catch(e){log('warn','Could not save language preference:',e.message)}this.currentLang=lang;this.broadcastChange(lang,rtl);log('info','Language applied:',lang,'| RTL:',rtl)}updateNavigationText(lang){const translations=window.SITE_TRANSLATIONS;if(!translations){log('warn','SITE_TRANSLATIONS not found on window');return}const langTranslations=translations[lang];if(!langTranslations){log('warn','No translations found for language:',lang);return}const elements=document.querySelectorAll('[data-i18n-key]');log('info','Found translatable elements:',elements.length);elements.forEach(element=>{const key=element.getAttribute('data-i18n-key');if(key&&langTranslations[key]){element.textContent=langTranslations[key]}});document.querySelectorAll('[data-i18n]').forEach(element=>{const key=element.getAttribute('data-i18n');const value=this.getNestedTranslation(langTranslations,key);if(value){if(element.tagName==='INPUT'||element.tagName==='TEXTAREA'){element.placeholder=value}else{element.textContent=value}}})}getNestedTranslation(obj,key){if(!key||!obj)return null;const keys=key.split('.');let value=obj;for(const k of keys){if(value&&typeof value==='object'&&k in value){value=value[k]}else{return null}}return typeof value==='string'?value:null}initializePicker(){const picker=document.getElementById('globalLangPicker');if(!picker){log('warn','Language picker (#globalLangPicker) not found');return}picker.value=this.currentLang;picker.addEventListener('change',(e)=>{const newLang=e.target.value;log('info','Picker changed to:',newLang);this.applyLanguage(newLang)});log('info','Language picker initialized')}setupEventListeners(){window.addEventListener('languageChanged',(e)=>{if(e.detail&&e.detail.language&&e.detail.language!==this.currentLang){log('info','External language change detected:',e.detail.language);this.applyLanguage(e.detail.language)}});window.addEventListener('popstate',()=>{const saved=this.getSavedLanguage();if(saved!==this.currentLang){this.applyLanguage(saved)}})}broadcastChange(lang,rtl){window.dispatchEvent(new CustomEvent('languageChanged',{detail:{language:lang,isRTL:rtl,timestamp:Date.now()}}))}getLanguage(){return this.currentLang}setLanguage(lang){this.applyLanguage(lang)}isRTL(){return isRTL(this.currentLang)}t(key){const translations=window.SITE_TRANSLATIONS;if(!translations||!translations[this.currentLang]){return key}return this.getNestedTranslation(translations[this.currentLang],key)||key}getSupportedLanguages(){return[...CONFIG.supportedLangs]}}window.languageManager=new UnifiedLanguageManager();window.i18n=window.languageManager;log('info','Language handler ready')})();